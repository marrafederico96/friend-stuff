@using FriendStuff.Features.Auth.DTOs
@using FriendStuff.Features.Group
@using FriendStuff.Features.Group.DTOs

@inject IGroupService GroupService
@inject NavigationManager NavigationManager

@rendermode  InteractiveServer

<EditForm Model="GroupData" FormName="GroupForm" OnValidSubmit="Submit">
    <MudTextField @bind-Value="GroupData.GroupName" Class="mb-2" T="string" Label="Group Name" Required="true" RequiredError="Group Name is required!" />
    @if (!string.IsNullOrEmpty(_error))
    {
        <MudText>@_error</MudText>
    } 
    <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit">Create Group</MudButton>
</EditForm>

@code {
    private GroupDto GroupData { get; set; } = new GroupDto();
    private string? _error = string.Empty;
    
    [Parameter]
    public UserInfoDto? UserInfo { get; set; }
    
    private async Task Submit()
    {
        try
        {
            if (UserInfo != null)
            {
                GroupData.AdminUsername = UserInfo.Username;
            }
            await GroupService.CreateGroup(GroupData);
            GroupData = new GroupDto();
            NavigationManager.NavigateTo("/", forceLoad:true);
        }
        catch (ArgumentException e)
        {
            _error = e.Message;
        }
        
    }
}
